TASK 6: 
ISSUE:
The convergence error plots (ratio to the power in full box) does NOT converge to 1 as expected at greater distance or time. 
A potential cause of this issue may be due to the average density not being comparable to the cosmic average density (fixed value that can be found analytically)
This is because the previous tasks takes the full box, does the simulation on it, then chops it up into subvolumes and get their power spectra. 
Consequently, their average densities are above or below the cosmic average density.
In comparison to the paper that does a similar simulation. They took their full box, took a subvolume, then did their simulations on that subvolume. 
Due to time, we have to circumvent this issue, by selecting cuts that have average densities comparable to the cosmic average density. 

	0th subtask:
Make sure you are reading in both the field and density data in the SAME orientation. i.e. make contour plots (like task 2) to view if they are in the same orientation. 

	1st subtask:
There are density field files, 1 for each full box (1 for the 1Gpc box and 1 for the 300 Mpc box)
The density field files are similar to the previous 21cm field files, except they are in units of the cosmic mean average density (value of 1)
Want to find the criterion to discard or keep certain densities (within some range of the cosmic average density) 
Using the desnity fields, perform the cuts and get the average densities to find the standard deviation. 
Therefore, average densities within c*std are kept (and their power spectra are found), while average densities outside this range are discarded. The constant value c will be adjusted to chose enough sub volumes to perform the analysis. The value for c may be 0.1 to 0.2, perhaps. 
Id est, for each subvolume with an average density within the average cosmic density +- the c*std are kept for the convergence analysis, else all subvolumes that fail to meet this condition are discarded and unused
Note that, this will need to be implemented into both the 300Mpc data and 1Gpc data

	2nd subtask:
Next will be to simply run the programs for both the 300Mpc and 1Gpc boxes, by selecting the subvolumes with average densities in the chosen range of the STD
and getting the convergence plots and error (ratio to total) plots 
NOTE that this may fail due to have too few cuts chosen or a incorrect chosen parameter c (for the range of valid densities). Thus, will likely need to do subtask 3, in which more subvolumes are generated.
	3rd subtask:
instead of cutting up the full box into subvolumes of fixed size.
Chose a box size and shift by the cell size or some factor times the cell size 
Do this for both the 1 Gpc box and 300 Mpc box.
Note that the 1Gpc box the full box is NOT equal to the number of cells 
but for the 300Mpc box the full box is equal to the number of cells 


ADDENDUM 1:
M1e11 folder contains the 21cm field data for the extreme model
M2e10 folder contains the 21cm field data for the oligarchic model
The intermediate model is left empty (disregarded) 



ADDENDUM 2: 
It will take some time for them to transfer, but in a while the 300 box density fields will be here:
/expanse/lustre/scratch/ccain002/temp_project/for_andrew/real_300_mod/

the hydro_Snapshots.txt folder tells you which snapshot numbers (1st column) line up with which redshifts (3rd column)


ADDENDUM 3:

yeah one thing you'll have to check is that you've read in the density and 21 cm fields with the same orientation.  I think the way of reading them in will have them aligned correctly, but you should make a plot to check.  If you plot a 21 cm field before reion starts (like at z = 12) you should find that the density field looks basically the same as the brightness field. This is because there are hardly any ionization bubbles (before reionization epoch). 



ADDENDUM 4:
Current issue with the fields and densities NOT looking the same at high redshift (z=12), therefore,
Try: having a separate color bar for the densities (instead of sharing the color bar with the fields)
And also set it to a log scale by taking log(densities) and setting the range from log(0.3) to log(10). 

If first attempt fails: 
You'll be able to see the density fields a lot better if you plot log(density) instead of density.  Usually if the fields don't align it is because some axes were switched, so try swapping e.g. x and z
This can be done by changing the ordering from C to fortran ordering when importing the data. 


ADDENDUM 5:
hey Andrew, sorry for the delay.  What you want to do is only use a given sub-volume if the mean density within it is sufficiently close to the cosmic mean.  so for instance, you could try +/- 0.1*sigma.  The thing to be careful of is that sigma here is not the standard deviation of the density field itself - it is the standard deviation of a sample of many average densities using sub-volumes of the target size.  So there are two steps here: (1) select many sub-volumes, find the mean densities in all of them, and then calculate the standard deviation of that sample, and (2) use that result to decide whether or not to use a given sub-volume in the 21 cm analysis.

Therefore, need to go back and get the correct STD. 
I.e. Oh, I see, I accidentally calculated the standard deviation of the density field itself instead of the standard deviation of the mean densities of many sub-volumes for a particular cut.

NOTE 1: 
the standard deviations for the subvolumes can be found in the LAE output in:
final_powers_5-12-23_1922 
modified_powers_5-7-23_1423 

Both of which are about 1 +- 0.99 for all redshifts all models all cuts 
Using a weight of 0.1 on the true std value 


ADDENDUM 6:
Regarding the 1Gpc/h plots with the cosmic density criteria (new) versus the plots without (old)

can you put both cases on the same plot?
I just want to make sure that the two results aren't too similar
if they are too close together it may be a hint that something is wrong









